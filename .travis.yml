language: cpp

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      env: ONE_TIME_TESTS=true
      services:
        - docker
      addons:
        apt:
          packages:
            - doxygen

before_install:
  - chmod +x ci/build-docker-image.sh
  - chmod +x ci/check-commit-format.sh
  - chmod +x ci/build-travis.sh
  - chmod +x ci/deploy-docker.sh
  - chmod +x ci/custom-timeout.sh
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo mkdir -p /etc/docker && echo '{"ipv6":true,"fixed-cidr-v6":"2001:db8:1::/64"}' | sudo tee /etc/docker/daemon.json && sudo service docker restart; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then ci/build-docker-image.sh docker/ci/Dockerfile bademcurrency/badem-ci; fi

script:
  - echo "Badem"

deploy:
  provider: script
  skip_cleanup: true
  script: ci/deploy-docker.sh
  on:
    all_branches: true
    condition: -n "$ONE_TIME_TESTS"